<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Admin - TENNESA</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <a href="index.html" class="logo">üéæ TENNESA</a>
  <nav>
    <a href="index.html" id="beranda-link">Beranda</a>
    <a href="tentang.html">Tentang</a>
    <a href="admin.html" id="dashboard-link">Dashboard</a>
  </nav>
  <div class="auth-btn">
    </div>
</header>

<section class="dashboard">
  <h2>Dashboard Admin</h2>
  <p>Kelola sistem reservasi TENNESA</p>

  <div class="summary">
    <div class="card">
      <h3>Total Booking</h3>
      <p><strong id="total-booking">0</strong></p>
    </div>
    <div class="card">
      <h3>Total Pendapatan</h3>
      <p><strong id="total-pendapatan">Rp 0</strong></p>
    </div>
    <div class="card">
      <h3>Total Lapangan</h3>
      <p><strong id="total-lapangan">0</strong></p>
    </div>
  </div>

  <h3>Kelola Data Lapangan</h3>
  <table class="data-table">
    <thead>
      <tr>
        <th>Nama</th>
        <th>Fasilitas</th>
        <th>Harga/Jam</th>
        <th>Status</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="courts-table-body">
      </tbody>
  </table>

  <button id="add-court-btn" style="margin-top:20px;padding:10px 20px;border:none;border-radius:8px;background:#0a0a23;color:#fff;font-weight:bold;cursor:pointer;">
    + Tambah Lapangan
  </button>
</section>

<script src="script.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const tableBody = document.getElementById("courts-table-body");
    const addCourtBtn = document.getElementById("add-court-btn");
    const totalBookingEl = document.getElementById("total-booking");
    const totalPendapatanEl = document.getElementById("total-pendapatan");
    const totalLapanganEl = document.getElementById("total-lapangan");


    // Fungsi untuk memuat ringkasan/summary dari API
    const loadSummary = async () => {
        try {
            const response = await fetch("api/summary.php");
            const data = await response.json();

            if (data.total_booking !== undefined) {
                totalBookingEl.textContent = data.total_booking;
                totalPendapatanEl.textContent = `Rp ${data.total_pendapatan.toLocaleString('id-ID')}`;
                totalLapanganEl.textContent = data.total_lapangan;
            }
        } catch (error) {
            console.error("Gagal memuat summary:", error);
        }
    };

    // Fungsi untuk merender data lapangan ke tabel dari API
    const renderCourts = async () => {
      try {
        const response = await fetch("api/courts.php");
        const courts = await response.json();
        
        tableBody.innerHTML = ""; // Kosongkan tabel sebelum diisi
        
        if (courts.length > 0) {
          courts.forEach(court => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${court.name}</td>
              <td>${court.facilities}</td>
              <td>Rp ${parseInt(court.price).toLocaleString('id-ID')}</td>
              <td><span style="color:${court.status === 'Tersedia' ? 'green' : 'red'};font-weight:bold;">${court.status}</span></td>
              <td class="action-btn">
                <button class="delete" data-id="${court.id}">üóëÔ∏è</button>
              </td>
            `;
            tableBody.appendChild(row);
          });
        } else {
          tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Belum ada data lapangan.</td></tr>';
        }
      } catch (error) {
        console.error("Gagal memuat data lapangan:", error);
        tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Gagal memuat data.</td></tr>';
      }
    };

    // Event listener untuk tombol tambah lapangan
    addCourtBtn.addEventListener("click", async () => {
      const name = prompt("Masukkan Nama Lapangan:");
      if (!name) return;
      const facilities = prompt("Masukkan Fasilitas (pisahkan dengan koma):");
      if (!facilities) return;
      const price = parseInt(prompt("Masukkan Harga per Jam (angka saja):"));
      if (isNaN(price)) return;


      if (name && facilities && price) {
        const newCourt = {
          name,
          facilities,
          price,
          status: "Tersedia"
        };
        
        try {
            // Kirim data ke API
            const response = await fetch("api/courts.php", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(newCourt)
            });
            const data = await response.json();

            if (data.success) {
                renderCourts(); // Muat ulang tabel
                loadSummary(); // Update summary
                alert("Lapangan baru berhasil ditambahkan!");
            } else {
                alert("Gagal menambahkan lapangan: " + data.message);
            }
        } catch (error) {
            alert("Terjadi kesalahan saat menambahkan lapangan.");
        }
        
      } else {
        alert("Input tidak valid. Semua kolom harus diisi.");
      }
    });
    
    // Event listener untuk tombol hapus (menggunakan event delegation)
    tableBody.addEventListener('click', async (e) => {
        if (e.target.classList.contains('delete')) {
            const courtId = parseInt(e.target.dataset.id);
            if (confirm('Apakah Anda yakin ingin menghapus lapangan ini?')) {
                try {
                    // Panggil API untuk menghapus
                    const response = await fetch(`api/courts.php?id=${courtId}`, {
                        method: "DELETE"
                    });
                    const data = await response.json();

                    if (data.success) {
                        renderCourts(); // Muat ulang tabel
                        loadSummary(); // Update summary
                        alert('Lapangan berhasil dihapus.');
                    } else {
                        alert('Gagal menghapus lapangan: ' + data.message);
                    }
                } catch (error) {
                    alert('Terjadi kesalahan saat menghapus lapangan.');
                }
            }
        }
    });

    // Panggil fungsi saat halaman dimuat
    renderCourts(); 
    loadSummary();
});
</script>

</body>
</html>